<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <script>
        async function loadItems() {
            const response = await fetch('http://localhost:40001/mesa');
            const data = await response.json();
            const tables = data.mesa; // Array de mesas

            const selectBox = document.getElementById('tableSelect');

            tables.forEach(table => {
                const option = document.createElement('option');
                option.value = table.id;
                option.textContent = `Mesa ${table.id} - Capacidade: ${table.mesaCapact}`;
                selectBox.appendChild(option);
            });
        }
        window.onload = loadItems;
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Página de Gerenciamento</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }

        .header {
            background-color: #333;
            overflow: hidden;
        }

        .header a {
            float: left;
            color: white;
            text-align: center;
            padding: 14px 16px;
            text-decoration: none;
        }

        .header a:hover {
            background-color: #ddd;
            color: black;
        }

        .dropdown {
            float: left;
            overflow: hidden;
        }

        .dropdown .dropbtn {
            font-size: 16px;
            border: none;
            outline: none;
            color: white;
            padding: 14px 16px;
            background-color: inherit;
            font-family: inherit;
            margin: 0;
        }

        .dropdown-content {
            display: none;
            position: absolute;
            background-color: #f9f9f9;
            min-width: 160px;
            box-shadow: 0px 8px 16px 0px rgba(0, 0, 0, 0.2);
            z-index: 1;
        }

        .dropdown-content a {
            float: none;
            color: black;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
            text-align: left;
        }

        .dropdown-content a:hover {
            background-color: #ddd;
        }

        .dropdown:hover .dropdown-content {
            display: block;
        }

        .form-container {
            display: none;
            padding: 20px;
            border: 1px solid #ccc;
            margin-top: 20px;
        }

        .form-container.active {
            display: block;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th,
        td {
            border: 1px solid black;
            padding: 8px;
            text-align: left;
        }

        th {
            background-color: #f2f2f2;
        }
    </style>
    <script>


        async function PesquisaDisp(event) {
            event.preventDefault(); // Impede o envio padrão do formulário
            const date = document.getElementById('data_pesquisa_disp').value;
            const response = await fetch(`http://localhost:40001/getdisp/${date}`);
            const disponibilidade = await response.json();
            const { DateDisponivel, hora_inicio, hora_fim } = disponibilidade.disponibilidade;
            try {
                document.getElementById('alldisponibilidade').innerHTML = " ";
                disponibilidade.disponibilidade.forEach(disponib => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                <td>${disponib.DateDisponivel}</td>
                <td>${disponib.hora_inicio}</td>
                <td>${disponib.hora_fim}</td>
                <td>Mesa: ${disponib.mesaId}</td>
                <td><button id="DeleteDisp" value="${disponib.id}" onclick="DeleteDisp(event)" style="width:100%">Deletar</button></td>
                <td><button id="AlterarDisp" 
                            data-disponib='${JSON.stringify(disponib)}' 
                            onclick="showForm(event, 'form-disponibilidade-alterar')" 
                            style="width:100%">Alterar</button></td>
            `;
                    document.getElementById('alldisponibilidade').appendChild(row);
                    localStorage.setItem('idAlterarDisp', disponib.id);
                });
            }
            catch (error) {
                console.error('Error loading disponibilidade:', error); ''
            }
        }
        async function CarregaDispAlt(event) {
            alert("carrega dados");
        }
        async function DeleteDisp(event) {
            const Dispid = document.getElementById('DeleteDisp').value;
            var botao = document.getElementById("btnPesqDisp");

            const data = {
                id: Dispid
            };

            try {
                const response = await fetch('http://localhost:40001/deldisp', {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    alert(`Erro: essa mensagem`);
                    return false;
                }

                const result = await response.json();
                alert('Disponibilidade Deletada com sucesso!');
                botao.click();
                console.log(result);
            } catch (error) {
                console.error('Erro:', error);
                alert('Erro ao deletar a disponibilidade');
            }
        }

        async function CreateDisp(event) {
            event.preventDefault(); // Impede o envio padrão do formulário

            // Obtendo os valores dos campos do formulário
            const NumMesa = document.getElementById('tableSelect').value;
            const date = document.getElementById('data').value;
            const horainicio = document.getElementById('horainicio').value;
            const horafim = document.getElementById('horafim').value;

            // Dados que serão enviados
            const data = {
                mesaId: NumMesa,
                date: date,
                hora_inicio: horainicio,
                hora_fim: horafim,
            };

            try {
                const response = await fetch('http://localhost:40001/disp/add', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    alert(`Erro: essa mensagem`);
                    return false;
                }

                const result = await response.json();
                alert('Disponibilidade cadastrada com sucesso!');
                console.log(result);
            } catch (error) {
                console.error('Erro:', error);
                alert('Erro ao cadastrar o disponibilidade');
            }
        }
        async function CreateMesa(event) {
            event.preventDefault(); // Impede o envio padrão do formulário

            // Obtendo os valores dos campos do formulário
            const CapactMesa = document.getElementById('capacidade').value;

            // Dados que serão enviados
            const data = {
                mesaCapact: CapactMesa
            };

            try {
                const response = await fetch('http://localhost:40001/mesa/add', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    alert(`Erro: essa mensagem`);
                    return false;
                }

                const result = await response.json();
                alert('Mesa cadastrada com sucesso!');
                console.log(result);
            } catch (error) {
                console.error('Erro:', error);
                alert('Erro ao cadastrar o mesa');
            }
        }
        async function CreatePrato(event) {
            event.preventDefault(); // Impede o envio padrão do formulário

            // Obtendo os valores dos campos do formulário
            const PratoClass = document.getElementById('classprato').value;
            const PratoValor = document.getElementById('valorprato').value;
            const PratoDesc = document.getElementById('descprato').value;
            const PratoNome = document.getElementById('nomeprato').value;

            // Dados que serão enviados
            const data = {
                pratoName: PratoNome,
                pratoValor: PratoValor,
                pratoDesc: PratoDesc,
                pratoClass: PratoClass
            };

            try {
                const response = await fetch('http://localhost:40001/prato/add', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    alert(`Erro: essa mensagem`);
                    return false;
                }

                const result = await response.json();
                alert('Prato cadastrado com sucesso!');
                console.log(result);
            } catch (error) {
                console.error('Erro:', error);
                alert('Erro ao cadastrar o Prato');
            }
        }

        async function CreateUser(event) {
            event.preventDefault(); // Impede o envio padrão do formulário

            // Obtendo os valores dos campos do formulário
            const nome = document.getElementById('nome').value;
            const endereco = document.getElementById('endereco').value;
            const telefone = document.getElementById('telefone').value;
            const email = document.getElementById('email').value;
            const senha = document.getElementById('senha').value;
            const confirmarSenha = document.getElementById('confirmar_senha').value;
            const ClassUser = document.getElementById('classuser').value;


            if (senha !== confirmarSenha) {
                alert('As senhas não coincidem!');
                return false;
            }

            // Dados que serão enviados
            const data = {
                name: nome,
                endereco: endereco,
                telefone: telefone,
                email: email,
                password: senha,
                type: ClassUser // Adicione outros campos necessários aqui
            };

            try {
                const response = await fetch('http://localhost:40001/user/signup', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    alert(`Erro: essa mensagem`);
                    return false;
                }

                const result = await response.json();
                alert('Usuário cadastrado com sucesso!');
                console.log(result);
            } catch (error) {
                console.error('Erro:', error);
                alert('Erro ao cadastrar o usuário');
            }
        }
        async function AlterarDisp(event) {
            event.preventDefault(); // Impede o envio padrão do formulário
            const IdALterar = localStorage.getItem('idAlterarDisp');
            var botao = document.getElementById("btnPesqDisp");

            const NumMesa = document.getElementById('NumMesa_alterar_disp').value;
            const Date = document.getElementById('data_alterar_disp').value;
            const HoraInicio = document.getElementById('hora_inicio_alterar').value;
            const HoraFim = document.getElementById('hora_fim_alterar').value;

            const data = {
                mesaId: NumMesa,
                DateDisponivel: Date,
                hora_inicio: HoraInicio,
                hora_fim: HoraFim,
            };

            try {
                alert(IdALterar);
                const response = await fetch(`http://localhost:40001/disp/${IdALterar}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                if (!response.ok) {
                    const errorData = await response.json();
                    alert(`Erro: essa mensagem`);
                    return false;
                }

                const result = await response.json();
                alert('Disponibilidade alterada com sucesso!');
                console.log(result);
                botao.click();
            }
            catch (error) {
                console.error('Erro:', error);
                alert('Erro ao alterar disponibilidade');
            }
        }
    </script>
</head>

<body>

    <div class="header">
        <div class="dropdown">
            <button class="dropbtn">Disponibilidade</button>
            <div class="dropdown-content">
                <a href="#" onclick="showForm(event, 'form-disponibilidade-criar')">Criar</a>
                <a href="#" onclick="showForm(event, 'form-disponibilidade-pesquisar')">Pesquisar</a>
            </div>
        </div>
        <div class="dropdown">
            <button class="dropbtn">Mesa</button>
            <div class="dropdown-content">
                <a href="#" onclick="showForm(event, 'form-mesa-criar')">Criar</a>
                <a href="#" onclick="showForm(event, 'form-mesa-pesquisar')">Pesquisar</a>
            </div>
        </div>
        <div class="dropdown">
            <button class="dropbtn">Prato</button>
            <div class="dropdown-content">
                <a href="#" onclick="showForm(event,'form-prato-criar')">Criar</a>
                <a href="#" onclick="showForm(event,'form-prato-pesquisar')">Pesquisar</a>
            </div>
        </div>
        <div class="dropdown">
            <button class="dropbtn">Usuários</button>
            <div class="dropdown-content">
                <a href="#" onclick="showForm(event,'form-usuario-criar')">Criar</a>
                <a href="#" onclick="showForm(event,'form-usuario-pesquisar')">Pesquisar</a>
            </div>
        </div>
            <a href="login.html" id="loginLink" class="login">Login</a>
    </div>

    <div id="form-disponibilidade-criar" class="form-container">
        <h2>Criar Disponibilidade</h2>
        <form onsubmit="CreateDisp(event)">
            <label for="data">Número da Mesa:</label><br>
            <select name="select" id="tableSelect"><br>
                <option value="">Select an item</option>
            </select><br>
            <label for="data">Data da Reserva:</label><br>
            <input type="date" id="data" name="data" required><br>
            <label for="nome">Hora de inicio:</label><br>
            <input type="text" id="horainicio" name="nome"><br>
            <label for="nome">Hora final:</label><br>
            <input type="text" id="horafim" name="nome"><br>
            <button type="submit" class="btn cadastrar">Inserir</button>
        </form>
    </div>
    <div id="form-disponibilidade-pesquisar" class="form-container">
        <h2>Pesquisar Disponibilidade</h2>
        <form onsubmit="PesquisaDisp(event)">
            <label for="data">Data:</label><br>
            <input type="date" id="data_pesquisa_disp" name="data" required>
            <button type="submit" class="btn cadastrar" id="btnPesqDisp">Pesquisar</button>
        </form>
        <h1>Lista de Disponibilidades</h1>
        <table id="alldisponibilidade">

        </table>
    </div>

    <div id="form-disponibilidade-alterar" class="form-container">
        <button class="btn-arrow" onclick="showForm('form-disponibilidade-pesquisar')"><span
                class="arrow">&larr;</span></button>
        <h2>Alterar Disponibilidade</h2>
        <form onsubmit=" AlterarDisp(event)">
            <label for="nome">Número da Mesa:</label><br>
            <input type="text" id="NumMesa_alterar_disp" name="NumMesa_alterar_disp"><br>
            <label for="data">Data:</label><br>
            <input type="date" id="data_alterar_disp" name="data_alterar_disp" required><br>
            <label for="nome">Hora de Inicio:</label><br>
            <input type="text" id="hora_inicio_alterar" name="hora_inicio_alterar"><br>
            <label for="nome">Hora de Encerramento:</label><br>
            <input type="text" id="hora_fim_alterar" name="hora_fim_alterar"><br>
            <button type="submit" class="btn cadastrar" id="btnPesqDisp">Alterar</button>
        </form>
    </div>

    <div id="form-mesa-criar" class="form-container">
        <h2>Criar Mesa</h2>
        <form onsubmit="CreateMesa(event)">
            <label for="mesa">Capacidade da Mesa:</label><br>
            <input type="text" id="capacidade" name="mesa"><br>
            <button type="submit" class="btn cadastrar">Cadastrar</button>
        </form>
    </div>

    <div id="form-mesa-pesquisar" class="form-container">
        <h2>Pesquisar Mesa</h2>
        <form>
            <label for="mesa">Mesa:</label><br>
            <input type="text" id="mesa" name="mesa"><br>
            <input type="submit" value="Enviar">
        </form>
    </div>

    <div id="form-prato-criar" class="form-container">
        <h2>Criar Prato</h2>
        <form onsubmit="CreatePrato(event)">
            <label for="prato">Nome do Prato:</label><br>
            <input type="text" id="nomeprato" name="prato"><br>
            <label for="prato">Valor do Prato:</label><br>
            <input type="text" id="valorprato" name="prato"><br>
            <label for="prato">Descrição do Prato:</label><br>
            <input type="text" id="descprato" name="prato"><br>
            <label for="prato">Prato:</label><br>
            <select name="select" id="classprato">
                <option value="">Select a Time</option>
                <option value="Aperitivos">Aperitivos</option>
                <option value="Blends Artesanais">Blends Artesanais</option>
                <option value="Acompanhamentos">Acompanhamentos</option>
                <option value="Especiais">Especiais</option>
                <option value="Bebidas">Bebidas</option>
            </select><br>
            <button type="submit" class="btn cadastrar">Cadastrar</button>
        </form>
    </div>

    <div id="form-prato-pesquisar" class="form-container">
        <h2>Pesquisar Prato</h2>
        <form>
            <label for="prato">Prato:</label><br>
            <input type="text" id="prato" name="prato"><br>
            <input type="submit" value="Enviar">
        </form>
    </div>

    <div id="form-usuario-criar" class="form-container">
        <h2>Criar Usuário</h2>
        <form onsubmit="CreateUser(event)">

            <label for="nome">Nome:</label><br>
            <input type="text" id="nome" name="nome" required><br>


            <label for="endereco">Endereço:</label><br>
            <input type="text" id="endereco" name="endereco" required><br>

            <label for="telefone">Telefone:</label><br>
            <input type="tel" id="telefone" name="telefone" required><br>

            <label for="email">E-mail:</label><br>
            <input type="email" id="email" name="email" required><br>

            <label for="senha">Senha:</label><br>
            <input type="password" id="senha" name="senha" required><br>

            <label for="confirmar_senha">Confirmar Senha:</label><br>
            <input type="password" id="confirmar_senha" name="confirmar_senha" required><br>

            <select name="select" id="classuser">
                <option value="admin">Administrador</option>
                <option value="Cliente">Cliente</option>
            </select><br>

            <button type="submit" class="btn cadastrar">Cadastrar</button>

        </form>
    </div>

    <div id="form-usuario-alterar" class="form-container">
        <h2>Alterar Usuário</h2>
        <form>
            <label for="usuario">Usuário:</label><br>
            <input type="text" id="usuario" name="usuario"><br>
            <input type="submit" value="Enviar">
        </form>
    </div>

    <div id="form-usuario-deletar" class="form-container">
        <h2>Deletar Usuário</h2>
        <form>
            <label for="usuario">Usuário:</label><br>
            <input type="text" id="usuario" name="usuario"><br>
            <input type="submit" value="Enviar">
        </form>
    </div>

    <div id="form-usuario-pesquisar" class="form-container">
        <h2>Pesquisar Usuário</h2>
        <form>
            <label for="usuario">Usuário:</label><br>
            <input type="text" id="usuario" name="usuario"><br>
            <input type="submit" value="Enviar">
        </form>
    </div>

    <script>
        function showForm(event, formId) {
            // Hide all forms
            var forms = document.querySelectorAll('.form-container');
            forms.forEach(function (form) {
                form.classList.remove('active');
            });
            // Show the selected form
            var form = document.getElementById(formId);
            if (form) {
                form.classList.add('active');
            }

            if (event.target.dataset) {
                const disponibData = JSON.parse(event.target.dataset.disponib);

                document.getElementById('data_alterar_disp').value = disponibData.DateDisponivel;
                document.getElementById('hora_inicio_alterar').value = disponibData.hora_inicio;
                document.getElementById('hora_fim_alterar').value = disponibData.hora_fim;
                document.getElementById('NumMesa_alterar_disp').value = disponibData.mesaId;
            }
        }
    </script>

</body>

</html>